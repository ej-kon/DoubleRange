class DoubleRange{static#t=0;static#i=new WeakMap;#s=!1;#e=null;#h=!1;#o=null;#a=null;#n=null;#r=null;#l=null;#u=null;#m=null;#c=null;#b=null;#f=null;#g=null;#d=0;#w=null;#p=null;#v=null;#$=0;#R=100;#y=1;#x=0;#D=100;#E=null;#T=!1;#M=null;#k=null;#F=null;#C=i=>this.#L(i,"from");#A=i=>this.#L(i,"to");#j=i=>this.#L(i,"from",!0);#z=i=>this.#L(i,"to",!0);#O=i=>this.#S(i,"from");#V=i=>this.#S(i,"to");#q=i=>this.#K(i);#B=i=>this.#U(i);#I=()=>this.#W();#G=i=>this.#U(i);#H=()=>this.#W();static create(i){if(!i||"object"!=typeof i)throw new TypeError("config must be an object");if(["selector"].forEach(s=>{if("string"!=typeof i[s])throw new TypeError(`${s} must be a string`)}),["min","max","from","to","step"].forEach(s=>{if("number"!=typeof i[s])throw new TypeError(`${s} must be a number`)}),i.from<i.min||i.from>i.max)throw new RangeError("from value out of range");if(i.to<i.min||i.to>i.max)throw new RangeError("to value out of range");if(i.from>=i.to)throw new RangeError("from must be less than to");if("function"!=typeof i.callback)throw new TypeError("callback must be a function");"number"!=typeof i.delay&&(i.delay=0),"function"!=typeof i.formatter&&(i.formatter=i=>i),"string"!=typeof i.label&&(i.label="Range selector"),DoubleRange.#t++;const s="double-range-"+DoubleRange.#t,e=DoubleRange.#J(i.selector);return e.textContent="",e.insertAdjacentHTML("beforeend",`<div class="double-range"><div role="group" aria-label="${i.label}"><aside class="start point"></aside><aside class="min limit">${i.formatter(i.min)}</aside><label for="${s}-from" class="from"><span>${i.formatter(i.from)}</span></label><div class="track" role="none"><div class="thumb from" id="${s}-from" role="slider" tabindex="0" aria-orientation="horizontal" aria-valuemin="${i.min}" aria-valuemax="${i.max}" aria-valuenow="${i.from}" aria-valuetext="${i.formatter(i.from)}"></div><div class="thumb to" id="${s}-to" role="slider" tabindex="0" aria-orientation="horizontal" aria-valuemin="${i.min}" aria-valuemax="${i.max}" aria-valuenow="${i.to}" aria-valuetext="${i.formatter(i.to)}"></div><div class="range-bar"></div></div><label for="${s}-to" class="to"><span>${i.formatter(i.to)}</span></label><aside class="max limit">${i.formatter(i.max)}</aside><aside class="end point"></aside></div></div>`),new DoubleRange(i)}constructor(i){if("string"!=typeof i.selector)throw new TypeError("selector must be a string");if("function"!=typeof i.callback)throw new TypeError("callback must be a function");"function"==typeof i.beforeFromChange&&(this.#p=i.beforeFromChange),"function"==typeof i.beforeToChange&&(this.#v=i.beforeToChange),this.#d="number"==typeof i.delay?i.delay:0,this.#f="function"==typeof i.formatter?i.formatter:i=>i,this.#g=i.callback;const s=DoubleRange.#J(i.selector);if(DoubleRange.#i.has(s))throw new Error("DoubleRange is already initialized on this element");if(this.#a=s.querySelector(".thumb.thumb.from"),this.#n=s.querySelector(".thumb.thumb.to"),this.#r=s.querySelector("label.from"),this.#l=this.#r.querySelector("span"),this.#u=s.querySelector("label.to"),this.#m=this.#u.querySelector("span"),this.#c=s.querySelector(".min.limit"),this.#b=s.querySelector(".max.limit"),this.#o=s.querySelector(".track"),this.#e=s.querySelector(".double-range"),!(this.#e&&this.#a&&this.#n&&this.#o&&this.#r&&this.#u&&this.#l&&this.#m))throw new Error("Missing required elements");if(this.#$=parseFloat(this.#a.getAttribute("aria-valuemin")),this.#R=parseFloat(this.#a.getAttribute("aria-valuemax")),this.#y=i.step??1,this.#x=parseFloat(this.#a.getAttribute("aria-valuenow"))||i.from||this.#$,this.#D=parseFloat(this.#n.getAttribute("aria-valuenow"))||i.to||this.#R,this.#x>=this.#D)throw new Error("Initial values: from must be less than to");DoubleRange.#i.set(this.#e,this);let e=!0;this.#F=new ResizeObserver(()=>{e?e=!1:this.#e.isConnected?this.#N():this.destroy()}),this.#F.observe(this.#e),this.#s=!1,this.#N(),this.#P(),this.#Q();const h=window.getComputedStyle(this.#r,"::after");if(h.content){const i=`translate(calc(-50% + ${h.width}), -50%)`;this.#r.style.transform=i,this.#r.style.webkitTransform=i}}#N=()=>{this.#M=this.#o.getBoundingClientRect(),this.#k=this.#e.getBoundingClientRect(),this.#X(),this.#Y()};static getBySelector(i){const s=DoubleRange.#J(i).querySelector(".double-range");return s&&DoubleRange.#i.has(s)?DoubleRange.#i.get(s):null}static getByContainer(i){const s=i.querySelector(".double-range");return s&&DoubleRange.#i.has(s)?DoubleRange.#i.get(s):null}static#J(i){const s=document.querySelectorAll(i);if(0===s.length)throw new Error(`Element ${i} not found`);if(s.length>1)throw new Error(`Multiple elements match ${i}`);return s[0]}#K(i){const s=(i.clientX-this.#M.left)/this.#M.width,e=this.#$+s*(this.#R-this.#$),h=Math.round((e-this.#$)/this.#y)*this.#y+this.#$;Math.abs(h-this.#x)<Math.abs(h-this.#D)?this.setFrom(h):this.setTo(h)}#Q(){this.#a.addEventListener("mousedown",this.#C),this.#n.addEventListener("mousedown",this.#A),this.#a.addEventListener("touchstart",this.#j,{passive:!1}),this.#n.addEventListener("touchstart",this.#z,{passive:!1}),this.#a.addEventListener("keydown",this.#O),this.#n.addEventListener("keydown",this.#V),this.#o.addEventListener("click",this.#q)}#L(i,s,e=!1){i.preventDefault(),"from"===s?(this.#a.style.zIndex=3,this.#n.style.zIndex=2,this.#a.classList.add("dragging")):(this.#a.style.zIndex=2,this.#n.style.zIndex=3,this.#n.classList.add("dragging")),this.#E=s,this.#T=!0,clearTimeout(this.#w),document.addEventListener("mousemove",this.#B),document.addEventListener("mouseup",this.#I),document.addEventListener("touchmove",this.#G,{passive:!1}),document.addEventListener("touchend",this.#H),document.body.classList.add("double-range-dragging")}#U(i){if(!this.#E)return;const s=i.clientX??i.touches?.[0]?.clientX;if(!s||!this.#M)return;const e=Math.max(0,Math.min(1,(s-this.#M.left)/this.#M.width)),h=this.#$+e*(this.#R-this.#$),o=Math.round((h-this.#$)/this.#y)*this.#y+this.#$;this.#Z(this.#E,o)}#W(){this.#E&&(document.removeEventListener("mousemove",this.#B),document.removeEventListener("mouseup",this.#I),document.removeEventListener("touchmove",this.#G),document.removeEventListener("touchend",this.#H),this.#E=null,this.#T=!1,this.#a.classList.remove("dragging"),this.#n.classList.remove("dragging"),this.#_(),document.body.classList.remove("double-range-dragging"))}#S(i,s){const e=this.#y;let h=!1;switch(i.key){case"ArrowLeft":case"ArrowDown":i.preventDefault(),this.#tt(s)-e>=this.#$&&(this.#Z(s,this.#tt(s)-e),h=!0);break;case"ArrowRight":case"ArrowUp":i.preventDefault(),this.#tt(s)+e<=this.#R&&(this.#Z(s,this.#tt(s)+e),h=!0)}h&&this.#_()}#tt(i){return"from"===i?this.#x:this.#D}#Z(i,s){"from"==i?this.setFrom(s):this.setTo(s)}#Y(){this.#c.textContent=this.#f(this.#$),this.#c.style.left="0px";let i=this.#c.getBoundingClientRect().left-this.#k.left;i<0&&(this.#c.style.left=-1*i+"px"),this.#b.textContent=this.#f(this.#R),this.#b.style.right="0px";const s=this.#b.getBoundingClientRect();i=s.left-this.#k.left;const e=i+s.width-this.#k.width;e>0&&(this.#b.style.right=`${e}px`)}#X(){this.#h&&this.#e.classList.remove("collision"),this.#h=!1,this.#l.textContent=this.#f(this.#x),this.#m.textContent=this.#f(this.#D);const i=this.#R-this.#$;let s=`${(this.#x-this.#$)/i*100}%`,e=`${(this.#D-this.#$)/i*100}%`;if(this.#r.style.left=s,this.#u.style.left=e,!this.#r.offsetParent||!this.#u.offsetParent)return;let h=this.#r.getBoundingClientRect(),o=this.#u.getBoundingClientRect();const a=h.left+h.width-o.left;if(a>0){this.#e.classList.add("collision"),this.#h=!0;const i=a/2+"px";s+=` - ${i}`,this.#r.style.left=`calc(${s})`,e+=` + ${i}`,this.#u.style.left=`calc(${e})`,h=this.#r.getBoundingClientRect(),o=this.#u.getBoundingClientRect()}let n=o.left-this.#k.left;const r=n+o.width-this.#k.width;if(r>0){e+=` - ${r}px`,this.#u.style.left=`calc(${e})`,n=h.left-this.#k.left;let i=n+h.width-(this.#k.width-o.width);i>0&&(this.#e.classList.add("collision"),this.#h=!0,s+=` - ${i}px`,this.#r.style.left=`calc(${s})`)}n=h.left-this.#k.left,n<0&&(s+=` + ${-1*n}px`,this.#r.style.left=`calc(${s})`,n=o.left-this.#k.left,n<h.width&&(this.#e.classList.add("collision"),this.#h=!0,e+=` + ${h.width-n}px`,this.#u.style.left=`calc(${e})`))}#P(){const i=this.#R-this.#$,s=(this.#x-this.#$)/i*100,e=(this.#D-this.#$)/i*100;this.#a.style.left=`${s}%`,this.#n.style.left=`${e}%`;const h=this.#o.querySelector(".range-bar");h.style.left=`${s}%`,h.style.width=e-s+"%"}#_(){clearTimeout(this.#w),this.#w=setTimeout(()=>{this.#g(this.#x,this.#D),this.#e.dispatchEvent(new CustomEvent("range-change",{detail:{from:this.#x,to:this.#D},bubbles:!0}))},this.#d)}setMin(i,s=!0){if("number"!=typeof i)throw new TypeError("DoubleRange.setMin: min must be a number");if(i>=this.#R)throw new RangeError(`DoubleRange.setMin: min (${i}) must be less than max (${this.#R})`);if(i>this.#x)throw new RangeError(`DoubleRange.setMin: min (${i}) must be less than or equal to current from value (${this.#x})`);return this.#$=i,this.#a.setAttribute("aria-valuemin",i),this.#n.setAttribute("aria-valuemin",i),this.#X(),this.#Y(),this.#P(),s&&this.#_(),this}setMax(i,s=!0){if("number"!=typeof i)throw new TypeError("DoubleRange.setMax: max must be a number");if(i<=this.#$)throw new RangeError(`DoubleRange.setMax: max (${i}) must be greater than min (${this.#$})`);if(i<this.#D)throw new RangeError(`DoubleRange.setMax: max (${i}) must be greater than or equal to current to value (${this.#D})`);return this.#R=i,this.#a.setAttribute("aria-valuemax",i),this.#n.setAttribute("aria-valuemax",i),this.#X(),this.#Y(),this.#P(),s&&this.#_(),this}setFrom(i,s=!0){if("number"!=typeof i)throw new TypeError("DoubleRange.setFrom: from must be a number");return!(i<this.#$||i>this.#R)&&(!(i>=this.#D)&&(!(null!==this.#p&&!this.#p(i,this.#D))&&(this.#x=i,this.#a.setAttribute("aria-valuenow",i),this.#a.setAttribute("aria-valuetext",this.#f(i)),this.#X(),this.#P(),s&&this.#_(),this)))}setTo(i,s=!0){if("number"!=typeof i)throw new TypeError("DoubleRange.setTo: to must be a number");return!(i<this.#$||i>this.#R)&&(!(i<=this.#x)&&(!(null!==this.#v&&!this.#v(this.#x,i))&&(this.#D=i,this.#n.setAttribute("aria-valuenow",i),this.#n.setAttribute("aria-valuetext",this.#f(i)),this.#X(),this.#P(),s&&this.#_(),this)))}update(i,s=!0){if(!(i&&"object"==typeof i&&!Array.isArray(i)&&i.constructor===Object))throw new TypeError("DoubleRange.update: Argument must be a plain object with optional keys: min, max, from, to");const e={min:this.#$,max:this.#R,from:this.#x,to:this.#D},h={};for(const s of["min","max","from","to"])if(h[s]=void 0!==i[s]?i[s]:e[s],"number"!=typeof h[s])throw new TypeError(`DoubleRange.update: '${s}' must be a number`);if(h.min>=h.max)throw new RangeError(`DoubleRange.update: min (${h.min}) must be less than max (${h.max})`);if(h.from<h.min||h.from>h.max)throw new RangeError(`DoubleRange.update: from (${h.from}) must be between min (${h.min}) and max (${h.max})`);if(h.to<h.min||h.to>h.max)throw new RangeError(`DoubleRange.update: to (${h.to}) must be between min (${h.min}) and max (${h.max})`);if(h.from>=h.to)throw new RangeError(`DoubleRange.update: from (${h.from}) must be less than to (${h.to})`);return this.#$=h.min,this.#R=h.max,this.#x=h.from,this.#D=h.to,this.#a.setAttribute("aria-valuemin",h.min),this.#a.setAttribute("aria-valuemax",h.max),this.#a.setAttribute("aria-valuenow",h.from),this.#a.setAttribute("aria-valuetext",this.#f(h.from)),this.#n.setAttribute("aria-valuemin",h.min),this.#n.setAttribute("aria-valuemax",h.max),this.#n.setAttribute("aria-valuenow",h.to),this.#n.setAttribute("aria-valuetext",this.#f(h.to)),this.#X(),this.#Y(),this.#P(),s&&this.#_(),this}getFrom(){return this.#x}getTo(){return this.#D}getMin(){return this.#$}getMax(){return this.#R}getRange(){return{from:this.#x,to:this.#D}}destroy(){this.#s||(this.#a.removeEventListener("mousedown",this.#C),this.#n.removeEventListener("mousedown",this.#A),this.#a.removeEventListener("touchstart",this.#j),this.#n.removeEventListener("touchstart",this.#z),this.#a.removeEventListener("keydown",this.#O),this.#n.removeEventListener("keydown",this.#V),this.#o.removeEventListener("click",this.#q),this.#E&&this.#W(),this.#F&&(this.#F.disconnect(),this.#F=null),this.#w&&(clearTimeout(this.#w),this.#w=null),this.#e&&DoubleRange.#i.has(this.#e)&&DoubleRange.#i.delete(this.#e),this.#s=!0)}}